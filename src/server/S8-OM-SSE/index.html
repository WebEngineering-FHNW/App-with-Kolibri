<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dolphin</title>
    <style>

    </style>
</head>
<body>
<h1>Dolphin</h1>
<button id="add">add</button>
<div id="inputs">
</div>


<output id="out"></output>

<script type="module">

    import {defaultConsoleLogging} from "../../kolibri/logger/loggingSupport.js";
    import {LoggerFactory}         from "../../kolibri/logger/loggerFactory.js";
    import {OM}                    from "../../tetris/observableMap/om.js";
    import {dom, select}           from "../../kolibri/util/dom.js";
    import {LOG_DEBUG}             from "../../kolibri/logger/logLevel.js";
    import {connect}               from "./connect.js";

    defaultConsoleLogging("ch.fhnw", LOG_WARN);

    const log = LoggerFactory("ch.fhnw.kolibri.remote.rom");

    const om = OM("index.html");

    connect(window.location.origin, om);

    let keyCount = 0;
    om.onKeyAdded( key => { // whenever there is a new key that we care about
        keyCount++;

        // create view
        const [br, label, button] = dom(`<br><label>${key} <input></label><button>x</button>`);
        inputs.append(br, label, button);
        const [input] = select(label, "input");

        // data binding
        om.onChange( ( changedKey, value ) => {
            if (key === changedKey) {
                input.value = value;
            }
        });
        om.onKeyRemoved( removedKey => {
            if (removedKey === key) {
                br.remove();
                label.remove();
                button.remove();
            }
        });

        // view binding
        input.oninput  = _ => om.setValue(key, input.value);
        button.onclick = _ => om.removeKey(key);
    });

    add.onclick = _ => om.setValue("key_"+keyCount, keyCount);






</script>


</body>
</html>
