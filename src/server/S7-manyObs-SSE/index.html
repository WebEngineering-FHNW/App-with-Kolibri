<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Shared Text</title>
    <style>
        #out {
            display: grid;
            grid-template-columns: repeat( auto-fill, 30ch);
        }
        label {
            font-family:    system-ui;
            font-size:      70%;
            color:          #000a;
            margin-top:     1em;
        }
    </style>
</head>
<body>
<h1>Shared Text</h1>
<button id="add">Add</button>
<button id="add100">Add100</button>
<div id="out"></div>

<script type="module">
    import "../../kolibri/util/array.js";
    import {dom, select}                    from "../../kolibri/util/dom.js";
    import {defaultConsoleLogging}          from "../../kolibri/logger/loggingSupport.js";
    import {TOPIC}                          from "./remoteObservableConstants.js";
    import {active, RemoteObservableClient} from "./remoteObservableClient.js";

    defaultConsoleLogging("ch.fhnw", LOG_INFO);

    /**
     * Projector: displays the remotely observable value and
     * binds to remote data changes and local user input
     * @impure will change DOM and bindings
     * @param { NamedRemoteObservableType } namedObservable
     */
    const projectTextInput = namedObservable => {
        const { id, observable } = namedObservable;
        const [labelElem] = dom(`<label id="${id}"> ${id} <input> </label>`);
        const [textInput] = select(labelElem, "input");
        textInput .oninput   = _               => observable.setValue( active(textInput.value) );      // view binding
        observable.onChange( ({value, mode:_}) => textInput.value = value ?? "");                      // data binding
        document.getElementById("out").append(labelElem);
    };

    const remoteObservableClient = RemoteObservableClient(window.location.origin, TOPIC, projectTextInput);

    let runningId        = 0;
    const [addButton]    = select(document.body,"#add");
    addButton.onclick    = _ => remoteObservableClient.addObservableForID(`text-${runningId++}`);

    const [add100Button] = select(document.body,"#add100");
    add100Button.onclick = _ => 100..times( _ => remoteObservableClient.addObservableForID(`text-${runningId++}`) );

</script>


</body>
</html>
